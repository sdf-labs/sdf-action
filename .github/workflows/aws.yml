name: Run Compile on branch

on:
  push:
    branches:
      - harry/aws_creds
  pull_request:

jobs:
  tpch_redshift:
    runs-on: ubuntu-latest
    name: Run sdf compile
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: sdf compile step
        uses: ./ # Uses an action in the root directory
        id: sdf
        with:
          command: 'sdf compile --show all'
          workspace_dir: 'workspace/tpch_redshift'

          aws_region: 'us-west-2'
          aws_access_key_id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws_secret_access_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}

      # Use the output from the `sdf` step
      - name: Display the sdf output
        run: |
          echo "### SDF Run Logs ðŸªµ" >> $GITHUB_STEP_SUMMARY
          echo '```' >>$GITHUB_STEP_SUMMARY
          echo "${{ steps.sdf.outputs.log }}" >>$GITHUB_STEP_SUMMARY
          echo '```' >>$GITHUB_STEP_SUMMARY

